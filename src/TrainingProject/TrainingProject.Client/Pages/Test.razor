@page "/Test/"
@page "/Test/{testId}"

@inject HttpClient HttpClient

<h3>Test</h3>

@if (TestQuestions != null)
{
    foreach (var question in TestQuestions)
    {
        <QuestionComponent QuestionModel="question">
        </QuestionComponent>
    }
}
else
{
    <h2>Loading</h2>
}

@code {
    [Parameter]
    public string TestId { get; set; }

    public List<QuestionDTO> TestQuestions { get; set; }

    public AnswerResultDTO AnswerResult { get; set; }

    protected override async Task OnInitializedAsync()
    {
        var response = await HttpClient.GetAsync($"api/Test/{TestId}");

        response.EnsureSuccessStatusCode();

        TestQuestions = await response.Content.ReadAsJsonAsync<List<QuestionDTO>>();
    }

    protected async Task AnswerQuestion(QuestionAnswerDTO answer)
    {
        var response = await HttpClient.PostJsonAsync($"api/Test", answer);

        response.EnsureSuccessStatusCode();

        AnswerResult = await response.Content.ReadAsJsonAsync<AnswerResultDTO>();
    }
}
